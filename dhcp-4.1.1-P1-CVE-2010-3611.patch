diff -up dhcp-4.1.1-P1/server/dhcpv6.c.CVE-2010-3611 dhcp-4.1.1-P1/server/dhcpv6.c
--- dhcp-4.1.1-P1/server/dhcpv6.c.CVE-2010-3611	2010-11-03 13:54:03.000000000 +0100
+++ dhcp-4.1.1-P1/server/dhcpv6.c	2010-11-03 14:01:00.000000000 +0100
@@ -4254,10 +4254,25 @@ shared_network_from_packet6(struct share
 	 * If there is no link address, we will use the interface
 	 * that this packet came in on to pick the shared_network.
 	 */
-	} else {
+	} else if (packet->interface != NULL) {
 		status = shared_network_reference(shared,
 					 packet->interface->shared_network,
 					 MDL);
+                if (packet->dhcpv6_container_packet != NULL) {
+			log_info("[L2 Relay] No link address in relay packet "
+				 "assuming L2 relay and using receiving "
+				 "interface");
+                }
+
+	} else {
+		/*
+		 * We shouldn't be able to get here but if there is no link
+		 * address and no interface we don't know where to get the
+		 * pool from log an error and return an error.
+		 */
+		log_error("No interface and no link address " 
+			  "can't determine pool");
+		status = ISC_R_INVALIDARG;
 	}
 
 	return status;
@@ -5585,6 +5600,7 @@ dhcpv6_relay_forw(struct data_string *re
 
 	enc_packet->client_port = packet->client_port;
 	enc_packet->client_addr = packet->client_addr;
+	interface_reference(&enc_packet->interface, packet->interface, MDL);
 	enc_packet->dhcpv6_container_packet = packet;
 
 	msg_type = enc_opt_data.data[0];
